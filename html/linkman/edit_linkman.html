<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>

		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/appfont.css" rel="stylesheet" />
		<link href="../../css/main.css" rel="stylesheet" />
		<link href="../../css/chart.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/mui.picker.min.css" />
	</head>

	<body>
		<style>
			.button {
				color: #fff;
				border: 1px solid #4cd964;
				background-color: #4cd964;
				font-size: 18px;
				display: block;
				width: 100%;
				margin-bottom: 10px;
				padding: 15px 0
			}
			
			.mui-form {
				color: #636363;
			}
			
			.divborder {
				line-height: 40px;
				border-top: 1px solid #e8e8e8;
			}
		</style>
		<header id="header" class="mui-bar mui-bar-nav">
			<h1 class="mui-title">编辑联系人</h1>
			<a id="back" href="#offCanvasSide" class="mui-action-back mui-icon icon_app_02 mui-action-menu mui-icon-left-nav mui-pull-left"></a>
			<button id="confirmSelected" type="button" class="mui-btn mui-btn-link mui-pull-right color_white">完成</button>
		</header>

		<div class="fault_main" style="top:45px">
			<div class="form_info">
				<div><label>姓名</label>
					<dd><input id="Name" type="text" class="input_sys2"></dd>
				</div>
				<div style="margin:10px 0px 10px 0px;"><label>性别</label>
					<dd><input id="Sex" type="text" class="input_sys2"></dd>
				</div>
				<div style="margin:10px 0px 10px 0px;"><label>证件号码</label>
					<dd><input id="IDCard" type="text" class="input_sys2"></dd>
				</div>
				<div style="margin:10px 0px 10px 0px;"><label>手机号码</label>
					<dd><input id="PhoneNumber" type="text" class="input_sys2"></dd>
				</div>
			</div>
			<div class="mui-form">
				<ul style="margin-left: 15px;" id="ullinkman">
					<!--<div class="mui-input-row mui-left divborder" ><div style="display: flex;flex-direction: row;"><span style="min-width: 60px !important;display:inline-block;">测试</span><span style="width: 40px;display:inline-block;">男</span><span style="display:inline-block;">444************333</span><a style="margin-left: 50px;"><i class="mui-icon mui-icon-minus"></i></a></label></div>
					<div class="mui-input-row mui-left divborder" ><div style="display: flex;flex-direction: row;"><span style="min-width: 60px !important;display:inline-block;">测试</span><span style="width: 40px;display:inline-block;">男</span><span style="display:inline-block;">444************333</span><a style="margin-left: 50px;"><i class="mui-icon mui-icon-minus"></i></a></label></div>
					<div class="mui-input-row mui-left divborder" ><div style="display: flex;flex-direction: row;"><span style="min-width: 60px !important;display:inline-block;">测试</span><span style="width: 40px;display:inline-block;">男</span><span style="display:inline-block;">444************333</span><a style="margin-left: 50px;"><i class="mui-icon mui-icon-minus"></i></a></label></div>-->
				</ul>
			</div>
			<div class="line_box"></div>
			<div class="mui-form">
				<div style="border-top: 1px solid #e8e8e8;"></div>
				<ul>
					<li id="dtPicker">
						<a href="#" style="color: #000;">出生日期<span id="BirthDay">选择</span></a>
					</li>
				</ul>
			</div>
			<!--<div>
				<a href="#" class="fault_btn_ok long_btn" id="confirm">
				<i class="mui-icon icon_cloud"></i><span>确定订单</span>
			</a>
		</div>-->
			<div id="confirm" class="mui-content-padded">
				<button id="btnSave" type="button" class="mui-btn button">删&nbsp;&nbsp;&nbsp;&nbsp;除</button>
			</div>
		</div>
		<!--<div class="windows_bg" id="dialog" style="display: none;">
			<div class="windows_box">
				<div class="info_box two_btn" id="dialogtwo">
					<p id="title">确定删除联系人？</p>
					<a href="#" id="casncel">取消</a>
					<a href="#" class="left_line" id="close">确定</a>
				</div>
			</div>
		</div>-->
	</body>
	<script type="text/javascript" src="../../js/mui.min.js"></script>
	<script src="../../js/mui.picker.min.js"></script>
	<script src="../../js/muifun.js"></script>
	<script src="../../js/localDatabase.js"></script>
	<script src="../../js/post.js"></script>
	<script src="../../js/dao.js"></script>
	<script src="../../js/linkman.js"></script>
	<script>
		var birthDay;
		var Model = {};
		var newModel = {};
		var linkMan = new LinkMan();
		mui.init();
		mui.plusReady(function() {
			initpage();
		});
		

		function initpage() {
			var self = plus.webview.currentWebview();
			Model = self.data;
			setValue('Name',Model.Name);
			setValue('Sex',Model.Sex);
			setValue('IDCard',Model.IDCard);
			setValue('PhoneNumber',Model.PhoneNumber);
			document.getElementById("BirthDay").innerHTML = Model.BirthDay;
			document.getElementById('confirm').addEventListener('tap', function() {
				plus.nativeUI.showWaiting();
				linkMan.Delete(Model.Id, function(result) {
					console.log(JSON.stringify(result));
					plus.nativeUI.closeWaiting();
					if(result.status == 1) {
						mui.toast('删除联系人成功');
						var create = plus.webview.getWebviewById('select_people.html');
						mui.fire(create, 'Create', {});
						var list = plus.webview.getWebviewById('html/linkman/linkman_list.html');
						mui.fire(list, 'Changelinkman', {});
						mui.back();
					} else {
						mui.toast('删除联系人失败，请重试');
					}
				}, function() {
					plus.nativeUI.closeWaiting();
					mui.toast('请求失败');
				});
			});
			
			document.getElementById('confirmSelected').addEventListener('tap',function(){
				if(getValue('Name') == '') {
					mui.toast('请填写姓名');
					return;
				}
				if(getValue('Sex') == '') {
					mui.toast('请填写性别');
					return;
				}
				if(getValue('IDCard') == '') {
					mui.toast('请填写证件号码');
					return;
				}
				if(getValue('PhoneNumber') == '') {
					mui.toast('请填写手机号码');
					return;
				}
				if(document.getElementById("BirthDay").innerHTML == '选择') {
					mui.toast('请选择出生日期');
					return;
				}
				plus.nativeUI.showWaiting();
				newModel.Name = getValue('Name');
				newModel.Sex = getValue('Sex');
				newModel.IDCard = getValue('IDCard');
				newModel.BirthDay = document.getElementById("BirthDay").innerHTML;
				newModel.PhoneNumber = getValue('PhoneNumber');
				linkMan.Edit(Model.Id,newModel, function(result) {
					console.log(JSON.stringify(result));
					plus.nativeUI.closeWaiting();
					if(result.status == 1) {
						mui.toast('修改联系人信息成功');
						var create = plus.webview.getWebviewById('select_people.html');
						mui.fire(create, 'Create', {});
						var list = plus.webview.getWebviewById('html/linkman/linkman_list.html');
						mui.fire(list, 'Changelinkman', {});
						mui.back();
					} else {
						mui.toast('修改联系人失败，请重试');
					}
				}, function() {
					plus.nativeUI.closeWaiting();
					mui.toast('请求失败');
				});
			});
			
			mui('#dtPicker').on('tap', 'a', function() {
				var curTime = (new Date()).Format("yyyy-MM-dd");
				var year = new Date().getFullYear();
				var opt = {
					"type": "date",
					"value": curTime,
					"beginYear": year - 1,
					"endYear": year
				};
				var picker = new mui.DtPicker(opt);
				picker.show(function(rs) {
					document.getElementById("BirthDay").innerHTML = rs.text;
					birthDay = rs.text;
					picker.dispose();
				});
			});
		}
		mui.back = function(){
				plus.webview.currentWebview().close();
			}
	</script>

</html>