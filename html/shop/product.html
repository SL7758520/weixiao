<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/main.css" rel="stylesheet" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/appfont.css" rel="stylesheet" />

		<link href="../../css/font-awesome.min.css" rel="stylesheet" />
		<style type="text/css">
			html,
			body {
				background-color: #efeff4;
			}
			/*list列表*/
			
			.item {
				display: -webkit-box;
			}
			
			.position-atop img,
			.top-banner img,
			.position-bone img,
			.position-c img {
				width: 100%;
				display: block;
			}
			
			.position-a .position-atop,
			.position-b,
			.position-bone,
			.position-c {
				position: relative;
				overflow: hidden;
			}
			
			.position-b {
				margin: 0 10px;
			}
			
			.position-bcontent {
				margin-bottom: 10px;
				position: relative;
				border-radius: 8px;
			}
			
			.gray-lable {
				background-color: #FFFFFF;
				width: 100%;
				height: 55px;
				padding-left: 12px;
				border-bottom: 1px solid #EDEDED;
				margin: 5px 0px 5px 0px;
			}
			
			.gray-img {
				background-image: -webkit-linear-gradient(top, rgba(59, 59, 59, .6), rgba(27, 27, 27, .6), rgba(50, 50, 50, .4), rgba(31, 31, 31, .4));
				position: absolute;
				color: #FFFFFF;
				padding-top: 2px;
				font-size: 16px;
				bottom: 20px;
				right: 0px;
				width: 60px;
				height: 25px;
				border-radius: 50px 0px 0px 50px;
				text-align: center;
			}
			
			.first-line,
			.vicetitle {
				color: #6a6a6a;
				height: 25px;
				line-height: 30px;
			}
			
			.vicetitle {
				font-size: 13px;
			}
			
			.first-line .prices {
				color: #f99d1c;
				position: absolute;
				right: 15px;
				font-family: impact;
				font-size: 20px;
			}
			
			.position-abottom {
				margin: 5px 0;
			}
			
			.text {
				width: 75%;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}
			
			.information {
				width: 65%;
				margin-left: 5px;
			}
			
			.price {
				width: 35%;
				margin-left: 5px;
			}
			
			.new-price {
				font-size: 16px;
				color: #ff7c70;
				font-family: Impact, Arail, sans-serif;
				font-weight: bold;
			}
			
			.mui-table-view-cell {
				padding: 5px 5px;
			}
			
			.hotel-footer {
				position: fixed;
				display: flex;
				justify-content: space-between;
				background-color: #EFEFF4;
				/*border: solid 1px #ddd;*/
				/*box-shadow: 0px -5px 5px 0px rgba(0, 0, 0, 0.05);*/
				left: 0px;
				bottom: 0px;
				height: 51px;
				width: 100%;
			}
			
			.mui-btn-block {
				font-size: 18px;
				display: block;
				height: 100%;
			}
			
			.info {
				padding-left: 5px;
				background-color: #FFFFFF;
			}
			
			.Desc {
				background-color: #FFFFFF;
				padding-left: 15px;
			}
			
			.fg_title {
				margin-top: 10px;
				border-bottom: 1px solid #EDEDED;
			}
			
			i.mui-media-object {
				color: #ccc;
				font-size: 18px;
			}
			
			.hotel-right-text {
				position: absolute;
				font-size: 14px;
				height: 16px;
				line-height: 16px;
				right: 40px;
				top: 50%;
				margin-top: -8px;
			}
			
			.hotel-color-blue {
				color: #099FDE !important;
			}
		</style>
	</head>

	<body>
		<!--<!--<header id="header" class="mui-bar mui-bar-transparent">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">导航栏</h1>
		</header>-->
		<header class="mui-bar mui-bar-transparent" style="border-top-width: 0px;">
			<a href="#offCanvasSide" class="mui-action-back mui-icon icon_app_02 mui-action-menu mui-icon-left-nav mui-pull-left"></a>
			<h1 id="Tab_title" class="mui-title" style="color: #007aff;">导航栏</h1>
		</header>
		<div class="mui-content" style="margin-bottom: 51px;">
			<div class="position-a">
				<div id="image" class="position-atop">
					<img id="Shop_img" src="" alt="" onerror="this.src='../../images/shop.jpg'">
					<div class="gray-img">
						相册..
					</div>
				</div>
			</div>
			<div class="gray-lable ">
				<div class="first-line">
					<span id="title" class="bigtitle">三峡长海游轮5日游</span>
					<span class="prices" id="BottomPrice">1668起</span>
				</div>
				<div class="vicetitle" id="DistanceDesc">单船票，宜昌登船，含宜昌码头接站</div>
			</div>
			<div class="fg_title" style="margin-top: 1px;">
				基本信息
			</div>
			<div id="info" class="info"></div>
			<ul class="mui-table-view">
				<li class="mui-table-view-cell mui-media">
					<i class="fa fa-map-marker mui-media-object mui-pull-left"></i>
					<div id="maps" class="mui-media-body mui-navigate-right">
						<a id="LngLat" style="color: #000000;font-size: 14px;" class="mui-ellipsis">西客站南广场东侧</a>
						<p>点击在地图中查看</p>
						<span class="hotel-color-blue hotel-right-text">地图</span>
					</div>
				</li>
				<li class="mui-table-view-cell mui-media">
					<i class="fa fa-phone mui-media-object mui-pull-left"></i>
					<div id="tel" class="mui-media-body mui-navigate-right">
						<a id="Phone">010-88888888</a>
						<p>点击拨打电话</p>
						<span class="hotel-color-blue hotel-right-text">联系商家</span>
					</div>
				</li>
			</ul>
			<div class="fg_title">
				床位列表
			</div>
			<ul id="productList" class="mui-table-view content">
			</ul>
			<ul class="mui-table-view" style="margin-top: 10px;">
				<li class="mui-table-view-cell mui-collapse " style="padding: 12px 15px;font-size: 16px;color: #6a6a6a;">
					<a class="mui-navigate-right" href="#">庭院配置</a>
					<div id="CourtyardFacilityDesc" class="mui-collapse-content Desc">

					</div>
				</li>
				<li class="mui-table-view-cell mui-collapse" style="padding: 12px 15px;font-size: 16px;color: #6a6a6a;">
					<a class="mui-navigate-right" href="#">交通配套</a>
					<div id="TrafficDesc" class="mui-collapse-content Desc">

					</div>
				</li>
				<li class="mui-table-view-cell mui-collapse" style="padding: 12px 15px;font-size: 16px;color: #6a6a6a;">
					<a class="mui-navigate-right" href="#">医院配套</a>
					<div id="HospitalDesc" class="mui-collapse-content Desc">

					</div>
				</li>
				<li class="mui-table-view-cell mui-collapse" style="padding: 12px 15px;font-size: 16px;color: #6a6a6a;">
					<a class="mui-navigate-right" href="#">购物配套</a>
					<div id="ShoppingDesc" class="mui-collapse-content Desc">

					</div>
				</li>
				<li class="mui-table-view-cell mui-collapse" style="padding: 12px 15px;font-size: 16px;color: #6a6a6a;">
					<a class="mui-navigate-right" href="#">旅游配套</a>
					<div id="TourismDesc" class="mui-collapse-content Desc">

					</div>
				</li>
				<li class="mui-table-view-cell mui-collapse" style="padding: 12px 15px;font-size: 16px;color: #6a6a6a;">
					<a class="mui-navigate-right" href="#">公共配套</a>
					<div id="PublicDesc" class="mui-collapse-content Desc">

					</div>
				</li>
				<li class="mui-table-view-cell mui-collapse" style="padding: 12px 15px;font-size: 16px;color: #6a6a6a;">
					<a class="mui-navigate-right" href="#">教育配套</a>
					<div id="EducationalDesc" class="mui-collapse-content Desc">

					</div>
				</li>
			</ul>
			<!--<div class="fg_title">
				庭院配置
			
			</div>
			<div id="CourtyardFacilityDesc" class="Desc">
				
			</div>
			<div class="fg_title">
				交通配套
			</div>
			<div id="TrafficDesc" class="Desc">

			</div>
			<div class="fg_title">
				医院配套
			</div>
			<div id="HospitalDesc" class="Desc">

			</div>
			<div class="fg_title">
				购物配套
			</div>
			<div id="ShoppingDesc" class="Desc">

			</div>
			<div class="fg_title">
				旅游配套
			</div>
			<div id="TourismDesc" class="Desc">

			</div>
			<div class="fg_title">
				公共配套
			</div>
			<div id="PublicDesc" class="Desc">

			</div>
			<div class="fg_title">
				教育配套
			</div>
			<div id="EducationalDesc" class="Desc">

			</div>-->
		</div>
		<div class="hotel-footer">
			<button id="collect" type="button" class="mui-btn mui-btn-warning mui-btn-block">收藏</button>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/localDatabase.js"></script>
		<script src="../../js/post.js"></script>
		<script src="../../js/dao.js"></script>
		<script src="../../js/shop.js"></script>
		<script src="../../js/member.js"></script>
		<script src="../../js/gps.js"></script>
		<script type="text/javascript">
			mui.init();
			var _dataAccess = new DataAccess();
			var _shop = new Shop();
			var _member = new Member();
			var user;
			var shopId;
			var shopName;
			var div;
			var pageIndex = 1;
			var pageSize = 10;
			var cityId = 6201;
			var photoUrl;
			var shopInfo;
			var productList;
			var _self;
			var div;
			mui.plusReady(function() {
				_self = plus.webview.currentWebview();
				div = document.getElementById("productList");
				shopId = _self.data;
				photoUrl = _self.photoUrl;
				console.log(shopId + "------------" + photoUrl);
				var shopCollects = _dataAccess.getShopCollect();
				console.log(JSON.stringify(shopCollects));
				if(shopCollects != null) {
					for(var i = 0; i < shopCollects.length; i++) {
						if(shopId == shopCollects[i].ShopId) {
							document.getElementById("collect").innerText = "已收藏";
							break;
						}
					}
				}

				_shop.GetShopModel(shopId, function(datas) {
					if(datas.status == 1) {
						shopInfo = datas.result;
						document.getElementById("title").innerHTML = shopInfo.Name;
						document.getElementById("Tab_title").innerHTML = shopInfo.Name;
						document.getElementById("Shop_img").src = photoUrl + shopInfo.PhotoUrl;
						document.getElementById("DistanceDesc").innerHTML = shopInfo.DistanceDesc;
						document.getElementById("BottomPrice").innerHTML = shopInfo.BottomPrice + "元/月起";
						document.getElementById("info").innerHTML = shopInfo.Intro;
						document.getElementById("Phone").innerHTML = shopInfo.Phone;
						document.getElementById("LngLat").innerHTML = shopInfo.Address;
						setHtml("CourtyardFacilityDesc", shopInfo.CourtyardFacilityDesc);
						setHtml("TrafficDesc", shopInfo.TrafficDesc);
						setHtml("HospitalDesc", shopInfo.HospitalDesc);
						setHtml("ShoppingDesc", shopInfo.ShoppingDesc);
						setHtml("TourismDesc", shopInfo.TravelDesc);
						setHtml("PublicDesc", shopInfo.PublicServiceDesc);
						setHtml("EducationalDesc", shopInfo.SchoolDesc);

					} else {
						mui.toast(datas.message);
					}
				});

				document.getElementById("tel").addEventListener('tap', function(event) {
					if(mui.os.plus) {
						plus.device.dial(shopInfo.Phone + "");
					} else {
						location.href = 'tel:' + shopInfo.Phone;
					}

				});
				document.getElementById("maps").addEventListener("tap", function(event) {
					if('Android' === plus.os.name && navigator.userAgent.indexOf('StreamApp') > 0) {
						plus.nativeUI.toast('当前环境暂不支持地图插件');
						return;
					}
					//BD-09 to GCJ-02先将百度坐标转成中国坐标 (要 跟百度坐标位置相反)
					var tmp = GPS.bd_decrypt(23.115747,113.40807);
					//GCJ-02 to WGS-84再将中国坐标转成GPS坐标
					var dstarr = GPS.gcj_decrypt_exact(tmp['lat'], tmp['lon']);
					var dst = new plus.maps.Point(dstarr['lon'], dstarr['lat']); //目的地
					var shop = shopInfo.Name;
					var src = new plus.maps.Point(113.289886,23.125651); // 大钟寺
					plus.maps.openSysMap(dst, shop, src);
				});
				document.getElementById("image").addEventListener("tap", function(event) {
					gotoHtml("shop_pic.html", shopId, photoUrl);
				});
				document.getElementById("collect").addEventListener("tap", function(event) {
					if(document.getElementById("collect").innerText == "已收藏") {
						_member.RemoveShopCollect(shopId, function(datas) {
							if(datas.status == 1) {
								document.getElementById("collect").innerText = "收藏";
							}

							mui.toast(datas.message);
						});
					} else {
						_member.SetShopCollect(shopId, function(datas) {
							if(datas.status == 1) {
								document.getElementById("collect").innerText = "已收藏";
							}

							mui.toast(datas.message);
						});
					}

				});

				_shop.GetProducts(pageIndex, pageSize, shopId, 1, function(datas) {
					if(datas.status == 1) {
						productList = datas.result;
						addList(productList);
					} else {
						mui.toast(datas.message);
					}
				});
			});

			function setHtml(id, value) {
				document.getElementById(id).innerHTML = value;
			}

			function addList(datas) {
				div.innerHTML = "";
				for(var i = 0; i < datas.length; i++) {
					div.appendChild(creatCard(datas[i]));
				}
			}

			function creatCard(entity) {
				//			console.log("AAAAAAAAAAA");
				var li = document.createElement("li");
				li.className = 'mui-table-view-cell';
				var HasPickUp;
				if(entity.HasPickUp) {
					HasPickUp = "可接送";
				} else {
					HasPickUp = "不可接送";
				}
				var imgsrc;
				imgsrc = photoUrl + entity.PhotoUrl;

				if(entity.CollectCounts == null) {
					li.innerHTML = '<div class="item"><div ><img src=' + imgsrc + ' onerror="this.src=\'../../images/bed_small.jpg\'" style="width: 100px;height: 65px;"></div><div class="text"><div class="information"><h4>' + entity.CategoryName + '</h4><h5 style="margin-top: 8px;">' + HasPickUp + '</h5><h5 class="mui-ellipsis" style="margin-top: 8px;">' + entity.ShortDescription + '</h5></div><div class="price"><span class="new-price">￥' + entity.Price + '/月</span></div></div></div>';

				} else {
					li.innerHTML = '<div class="item"><div ><img src=' + imgsrc + ' onerror="this.src=\'../../images/bed_small.jpg\'" style="width: 100px;height: 65px;"></div><div class="text"><div class="information"><h4>' + entity.CategoryName + '</h4><h5 style="margin-top: 8px;">' + HasPickUp + '</h5><h5 class="mui-ellipsis" style="margin-top: 8px;">' + entity.ShortDescription + '</h5></div><div class="price"><span class="new-price">￥' + entity.Price + '/月</span><div id="" style="display: flex;align-items: center;margin-top: 5px;"><img src="../../images/heart@2x.png" style="width: 15px;height: 15px;" /><h5 style="margin-left: 5px;">' + entity.CollectCounts + '人关注</h5></div></div></div></div>';

				}

				li.addEventListener("tap", function(event) {
					gotoHtml("product_details.html", entity.Id, photoUrl);
				});

				return li;
			}

			function gotoHtml(u, datas, photoUrl) {
				mui.openWindow({
					url: u,
					id: u,

					show: {
						aniShow: 'pop-in'
					},
					waiting: {
						autoShow: true, //自动显示等待框，默认为true
						title: '正在加载...', //等待对话框上显示的提示内容
					},
					extras: {
						data: datas,
						photoUrl: photoUrl,
					}
				});
			}
			window.addEventListener("CreateOrder", function(e) {
				console.log('html/shop/product.html');
				var main = plus.webview.getWebviewById('main.html');
				mui.fire(main, 'CreateOrder', {});
				var task = plus.webview.getWebviewById('html/member/shop_order_list.html');
				mui.fire(task, 'listRefresh0');
				plus.webview.getWebviewById('html/shop/product.html').close();
			});
		</script>
	</body>

</html>