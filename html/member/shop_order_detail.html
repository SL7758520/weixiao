<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/appfont.css" rel="stylesheet" />
		<link href="../../css/main.css" rel="stylesheet" />
		<style type="text/css">
			.name_list2 li {
				float: left;
				margin: 0px 5px 5px 5px;
				text-align: center;
				color: #61bc24;
				font-size: 10px;
				position: relative;
				padding: 2px 22px 2px 14px;
				display: inline-block;
				border: 1px solid #61bc24;
				border-radius: 99px;
			}
			
			.name_list2 li a {
				color: #61bc24;
			}
			
			.name_list2 li:active {
				color: #fff;
				border: 1px solid #61bc24;
				background-color: #61bc24;
			}
			
			.name_list2 li:active a {
				color: #fff;
			}
			
			.name_list2 li:active .close_btn:after {
				color: #fff;
			}
			
			.name_list2 .close_btn:active:after {
				color: #fff;
			}
			
			.name_list2 .close_btn:after {
				font-family: Muiicons;
				font-size: 24px;
				font-weight: 400;
				font-style: normal;
				line-height: 1;
				display: inline-block;
				text-decoration: none;
				-webkit-font-smoothing: antialiased;
				content: '\e460';
				border: none;
				color: #61bc24;
				position: absolute;
				right: 2px;
				top: 2px;
			}
			
			.name_list2 .close_btn {
				width: 15px;
				height: 15px;
			}
			
			.nd_btn {
				width: 100%;
			}
		</style>
	</head>

	<body>
		<style>
			.orderstatus {
				padding: 10px 15px 5px 15px !important;
			}
			
			.orderid {
				padding: 5px 15px 10px 15px !important;
			}
			
			html,
			body {
				background-color: #efeff4;
			}
			
			.name_list2 {
				margin: 10px 10px 2px 2px;
				border: none;
			}
			
			.shopinfo {
				background-color: #4cd964;
				color: white;
			}
			
			.shopli {
				line-height: 0px;
				border-bottom: 0px !important;
			}
			
			.mui-form li a span:after {
				font-family: Muiicons;
				font-size: 18px;
				font-weight: 400;
				font-style: normal;
				line-height: 1;
				display: none;
				text-decoration: none;
				-webkit-font-smoothing: antialiased;
				position: absolute;
			}
			
			.hotel-footer {
				position: fixed;
				display: flex;
				justify-content: space-between;
				background-color: #EFEFF4;
				/*border: solid 1px #ddd;*/
				/*box-shadow: 0px -5px 5px 0px rgba(0, 0, 0, 0.05);*/
				left: 0px;
				bottom: 0px;
				height: 51px;
				width: 100%;
			}
		</style>
		<div class="windows_bg" id="dialog" style="display: none;">
			<!--通用弹窗标准-->
			<div class="windows_box">
				<div class="info_box" id="dialogone" style="display: none;text-align: left;">
					<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请确认您是否已经完成入住，并计划退离当前养老院？</p>
					<a href="#" id="notice" style="text-align: center;">确定</a>
				</div>
				<!--两按钮状态-->
				<div class="info_box two_btn" id="dialogtwo">
					<p id="confirmtitle">正在进行确认操作，请确定</p>
					<a href="#" id="casncel">确定</a>
					<a href="#" class="left_line" id="close">取消</a>
				</div>
			</div>
		</div>
		<!--主界面部分-->
		<header id="header" class="mui-bar mui-bar-nav">
			<h1 class="mui-title">订单信息</h1>
			<a href="#offCanvasSide" class="mui-action-back mui-icon icon_app_02 mui-action-menu mui-icon-left-nav mui-pull-left"></a>
		</header>
		<div class="fault_main" style="top:45px;background-color: #efeff4;">
			<!--<div class="mui-form" style="background-color: #FFFFFF;margin-top: 5px;">
				<ul>
					<li id="selectWaySetion">
						<a href="#" class="orderstatus">订单状态：<i id="orderstatus"></i></a>
						<a href="#" class="orderid">订单号：<i id="orderid"></i></a>
					</li>
				</ul>
			</div>-->
			<div class="form_info" style="background-color: #FFFFFF;margin-top: 5px;">
				<div style="border-bottom: 1px solid #e8e8e8;"><label>订单状态：</label>
					<dd><input type="text" id="orderstatus" class="input_sys1" readonly="readonly"></dd>
				</div>
				<div><label>订单号：</label>
					<dd><input type="text" id="orderid" class="input_sys1" readonly="readonly"></dd>
				</div>
			</div>
			<div class="form_info" style="background-color: #FFFFFF;margin-top: 5px;">
				<div><label>预定服务：</label>
					<dd><input type="text" id="servicename" class="input_sys1" readonly="readonly"></dd>
				</div>
				<div><label>入住时间：</label>
					<dd><input type="text" id="bookeddate" class="input_sys1" readonly="readonly"></dd>
				</div>
				<div><label>入住人数：</label>
					<dd><input type="text" id="peopleamount" class="input_sys1" readonly="readonly"></dd>
				</div>
			</div>
			<div class="form_info" style="background-color: #FFFFFF;margin-top: 5px;">
				<div><label>是否接送：</label>
					<dd><input type="text" id="haspickup" class="input_sys1" readonly="readonly"></dd>
				</div>
				<div><label style="width: 100px;">单人接送费用：</label>
					<dd style="margin-left: 100px;"><input type="text" id="costsingle" class="input_sys1" readonly="readonly"></dd>
				</div>
				<div><label style="width: 100px;">多人接送费用：</label>
					<dd style="margin-left: 100px;"><input type="text" id="costmultiplayer" class="input_sys1" readonly="readonly"></dd>
				</div>
			</div>
			<div class="form_info" style="background-color: #FFFFFF;margin-top: 5px;">
				<div><label>预定数量：</label>
					<dd><input type="text" id="quantity" class="input_sys1" readonly="readonly"></dd>
				</div>
				<div><label>单价：</label>
					<dd><input type="text" id="price" class="input_sys1" readonly="readonly"></dd>
				</div>
				<div><label>订单金额：</label>
					<dd><input type="text" id="cost" class="input_sys1" readonly="readonly"></dd>
				</div>
			</div>

			<div class="mui-form" style="background-color: #FFFFFF;margin-top: 5px;" id="shopinfo">
				<ul>
					<li class="shopli">
						<a href="#">商家信息：</a>
					</li>
					<li class="shopli">
						<a href="#" id="shopName"><span id="cityName"></span></a>
					</li>
					<li class="shopli">
						<a href="#" id="address"></a>
					</li>
					<li class="shopli">
						<a href="#" id="phone"></a>
					</li>
				</ul>
			</div>
			<div class="fault_bar three_btn" style="position: relative;">
				<a href="#" id="btnSaveLocal" class="mui-hidden">
				<i class="mui-icon icon_local"></i><span>完成入住</span>
			</a>
				<a href="#" class="h_btn" id="btnCancel">
					<i class="mui-icon icon_trash"></i><span id="cancelmes">取消订单</span>
				</a>
				<a href="#" class="fault_btn_ok" id="btnPay">
					<i class="mui-icon icon_cloud"></i><span id="paymes">支付</span>
				</a>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/post.js"></script>
		<script src="../../js/localDatabase.js"></script>
		<script src="../../js/dao.js"></script>
		<script src="../../js/member.js"></script>
		<script src="../../js/shop.js"></script>
		<script>
			mui.init();
			var _self;
			var FaultEntity;
			var status;
			var ShopId;
			var member = new Member();
			var shop = new Shop();
			var Status = ['待受理', '待支付', '待到达', '已到达'];
			mui.plusReady(function() {
				_self = plus.webview.currentWebview();
				FaultEntity = _self.data;
				status = _self.from;
				initpage();
				console.log(status + '====' + JSON.stringify(FaultEntity));
			});

			function initpage() {
				if(status == 0) {
					document.getElementById('btnPay').style.display = 'none';
				} else if(status == 1) {} else if(status == 2) {
					document.getElementById('cancelmes').innerHTML = '申请退款';
					document.getElementById('paymes').innerHTML = '完成入住';
				} else if(status == 3) {
					document.getElementById('btnSaveLocal').classList.remove('mui-hidden');
					document.getElementById('cancelmes').innerHTML = '申请退款';
					document.getElementById('paymes').innerHTML = '入住评价';
				}else if (status==9) {
					document.getElementById('btnPay').style.display = 'none';
					document.getElementById('btnCancel').style.display = 'none';
				}

				member.GetOrderDetails(FaultEntity.Id, function(result) {
					if(result.status == 1) {
						var entity = result.result;
						ShopId = entity.ShopId;
						shop.GetShopModel(ShopId, function(data) {
							console.log(JSON.stringify(data));
							if(data.status == 1) {
								setHtmls('shopName', data.result.Name + '<span id="cityName">' + '广州市' + '</span>');
								setHtmls('address', data.result.Address);
								setHtmls('phone', data.result.Phone);
							} else {
								mui.toast(data.message);
							}
						});
						setHtml('orderstatus', Status[entity.OrderStatus]);
						setHtml('orderid', entity.Id);
						setHtml('servicename', entity.ShopName + '-' + entity.ProductName);
						setHtml('bookeddate', entity.BookedDate);
						setHtml('peopleamount', entity.PeopleAmount);
						setHtml('haspickup', entity.HasPickUp ? '是' : '否');
						setHtml('costsingle', entity.PickUpCostSingle + '元/公里');
						setHtml('costmultiplayer', entity.PickUpCostMultiplayer + '元/公里');
						setHtml('quantity', entity.Quantity + '月');
						setHtml('price', entity.Price + '/月');
						setHtml('cost', entity.Cost + '元');
					} else {
						mui.toast(result.message);
					}
					//					console.log('接口返回:'+JSON.stringify(result));
				});
				document.getElementById('shopinfo').addEventListener('tap', function() {
					if(ShopId != '' && ShopId != undefined) {
						gotoHtml("../shop/product.html", ShopId);
					} else {
						mui.toast('暂无商户信息');
					}
				});
				document.getElementById('btnCancel').addEventListener('tap', function() {
					if(status <= 1) {
						if(FaultEntity.Id != '' && FaultEntity.Id != undefined) {
							gotoHtml("../shop/order_cancel.html", FaultEntity.Id);
						} else {
							mui.toast('订单ID有误');
						}
					} else if(status == 2) {
						mui.toast('申请退款');
						if(FaultEntity.Id != '' && FaultEntity.Id != undefined) {
							gotoHtml("../shop/order_apply_refund.html", FaultEntity.Id);
						} else {
							mui.toast('订单ID有误');
						}
					} else if(status == 3) {
						mui.toast('申请退款');
						if(FaultEntity.Id != '' && FaultEntity.Id != undefined) {
							gotoHtml("../shop/order_apply_refund.html", FaultEntity.Id);
						} else {
							mui.toast('订单ID有误');
						}
					}

				});
				document.getElementById('btnPay').addEventListener('tap', function() {
					if (status == 1) {
						if(FaultEntity.Id != '' && FaultEntity.Id != undefined) {
							gotoHtml("../shop/pay.html", FaultEntity);
						} else {
							mui.toast('订单ID有误');
						}
						mui.toast('支付');
					} else if(status == 2) {
						mui.toast('完成入住');
						if(FaultEntity.Id == '' || FaultEntity.Id == undefined) {
							mui.toast('订单ID有误');
							return;
						}
						document.getElementById('dialog').style.display = 'block';
						document.getElementById('dialogtwo').style.display = 'block';
					} else if(status == 3) {
						if(FaultEntity.Id != '' && FaultEntity.Id != undefined) {
							gotoHtml("../shop/order_comment.html", FaultEntity);
						} else {
							mui.toast('订单ID有误');
						}
						mui.toast('入住评价');
					}

				});
				document.getElementById('btnSaveLocal').addEventListener('tap',function(){
					shop.OrderFinish(FaultEntity.Id,function(result){
						if (result.status==1) {
							mui.toast(result.message);
							document.getElementById('dialog').style.display = 'block';
							document.getElementById('dialogone').style.display = 'block';
							document.getElementById('dialogtwo').style.display = 'none';
						}else{
							mui.toast(result.message);
						}
					});
				});
				document.getElementById('notice').addEventListener('tap',function(){
//					var list = plus.webview.getWebviewById('html/member/shop_order_list.html');
//					mui.fire(list, 'listRefresh2');
					dialog.style.display = 'none';
					var list = plus.webview.getWebviewById('html/member/shop_order_list.html');
					mui.fire(list, 'listRefresh3');
//					plus.webview.currentWebview().close();
					mui.openWindow({
							id: 'finsh_order_list.html',
							url: 'finsh_order_list.html',
							show: {
								aniShow: 'pop-in'
							},
							waiting: {
								autoShow: true,
								title: '正在加载...'
							}
						});
					
				});
				document.getElementById('casncel').addEventListener('tap', function() {
					shop.OrderFinish(FaultEntity.Id,function(result){
						console.log(JSON.stringify(result));
						if (result.status==1) {
							mui.toast(result.message);
							var list = plus.webview.getWebviewById('html/member/shop_order_list.html');
							mui.fire(list, 'listRefresh2');
							plus.webview.currentWebview().close();
						}else{
							mui.toast(result.message);
						}
					});
				});
				
				document.getElementById('close').addEventListener('tap', function() {
					dialog.style.display = 'none';
				});
			}

			function setHtml(ElementId, value) {
				document.getElementById(ElementId).value = value;
			}

			function setHtmls(ElementId, value) {
				document.getElementById(ElementId).innerHTML = value;
			}

			function gotoHtml(u, datas) {
				mui.openWindow({
					url: u,
					id: u,

					show: {
						aniShow: 'pop-in'
					},
					waiting: {
						autoShow: true, //自动显示等待框，默认为true
						title: '正在加载...', //等待对话框上显示的提示内容
					},
					extras: {
						data: datas,
						pageId: 'shop_order_detail.html'
					}
				});
			}
			window.addEventListener("cancelOrder", function(e) {
				var list = plus.webview.getWebviewById('html/member/shop_order_list.html');
				mui.fire(list, 'listRefresh' + status);
				plus.webview.currentWebview().close();
			});
		</script>
	</body>

</html>